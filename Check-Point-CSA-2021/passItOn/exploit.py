import os
import string
from subprocess import run,Popen, PIPE, STDOUT
import time
#FLAG: b'CSA{1_V1LL_me55_w1Th_t1mE!}'
#TODO: script doesn't break out of the loop

def main():
    #
    charlist = b'0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_!#$%&@'
    flag = b""
    child_proccess = Popen("Pass_it_on.exe", stdout=PIPE, stdin=PIPE)
    done =False
    round_num=0
    l=4
    flag = b"CSA{" + b"A" * (27 - 5) + b"}"
    while not done:
        averages = []
        for j,ch in enumerate(charlist):
            if done:
                break
            time_diffs = []
            for i in range(1):
                please_enter = child_proccess.stdout.readline()
                if l==27:
                    if b'Please enter your password to log in' not in please_enter:
                        print(please_enter)
                        done = True
                        break
                before = time.time()
                flag = flag[:l] + charlist[j:j + 1] + flag[l+1:]
                child_proccess.stdin.write(flag +b'\n')
                child_proccess.stdin.flush()
                res = child_proccess.stdout.readline()
                if b'Incorrect' not in res:
                    print(res)
                # if l > 25:
                #     if b'enter' not in please_enter:
                #         print(please_enter)
                #         done = True
                #         break
                after = time.time()
                diff = after-before
                time_diffs.append(diff)
            average = sum(time_diffs) / len(time_diffs)
            averages.append(average)


        k = averages.index(max(averages))
        next_char = charlist[k:k+1]
        flag = flag[:l] + next_char + flag[l + 1:]
        print(flag ,l)
        l+=1

    res = child_proccess.stdout.readline()
    print(res)
    child_proccess.stdin.write(flag + b'\n')

    # child_proccess.stdin.write(b"CSA{" + flag +b"}" + b'\r\n')
    child_proccess.stdin.flush()
    res = child_proccess.stdout.readline()
    print(res)
    child_proccess.terminate()

    print(flag)


if __name__ == "__main__":
    main()